name: Build Windows Executable

on:
   push:
     branches:
       - master
   pull_request:
     branches:
       - master

jobs:
   build-windows:
     runs-on: windows-latest

     steps:
       - name: Checkout repository
         uses: actions/checkout@v2

       - name: Set up Python
         uses: actions/setup-python@v2
         with:
           python-version: '3.9'

       - name: Install dependencies
         run: |
           python -m pip install --upgrade pip
           pip install pyinstaller
           pip install -r requirements.txt

       - name: Build executable
         run: pyinstaller --onefile main.py --add-data "C:\\hostedtoolcache\\windows\\Python\\3.9.13\\x64\\Lib\\site-packages\\emoji\\unicode_codes\\emoji.json;emoji/unicode_codes"

       - name: Create Release Tag
         id: create_tag
         shell: pwsh
         run: |
           $version = "$(Get-Date -Format 'yyyy.MM.dd').$env:GITHUB_RUN_NUMBER"
           git config --global user.name "github-actions"
           git config --global user.email "actions@github.com"
           git tag $version
           git push origin $version
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

       - name: Upload Release Asset
         uses: softprops/action-gh-release@v1
         with:
           files: dist/main.exe
           tag_name: ${{ steps.create_tag.outputs.tag }}
         env:
           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}